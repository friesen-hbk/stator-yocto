#!/bin/sh

state -l motherboard
state -l busboard

global hostname
global user
global autoboot_timeout
global boot.default
global allow_color
global linux.bootargs.base
global linux.bootargs.console
global linux.bootargs.dyn.ip
global linux.bootargs.dyn.root

[ -z "${global.hostname}" ] && global.hostname=generic
[ -z "${global.user}" ] && global.user=none
magicvar -a global.user "username (used in network filenames)"
[ -z "${global.autoboot_timeout}" ] && global.autoboot_timeout=3
magicvar -a global.autoboot_timeout "timeout in seconds before automatic booting"
[ -z "${global.boot.default}" ] && global.boot.default=net
[ -z "${global.allow_color}" ] && global.allow_color=true
magicvar -a global.allow_color "Allow color on the console (boolean)"

eth0.ethaddr=${motherboard.mac0}

global dhcp.vendor_id=HBM-${motherboard.typ}

/env/bin/boardinfo

. /env/bin/factory_update

for i in /env/init/*; do
    . $i
done

if [ -n ${global.autoboot_timeout} ]; then
    echo
    echo -n "Hit any key to stop autoboot: "
    timeout -a ${global.autoboot_timeout}
    if [ $? != 0 ]; then
	menutree
    fi

    boot
fi
